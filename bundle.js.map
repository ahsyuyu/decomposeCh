{
  "version": 3,
  "sources": [
    "../../../usr/local/lib/node_modules/ksana-cli/node_modules/browserify/node_modules/browser-pack/_prelude.js",
    "decomposeCh/index.js",
    "decomposeCh/src/main.jsx",
    "node_modules/ksana2015-webruntime/checkbrowser.js",
    "node_modules/ksana2015-webruntime/downloader.js",
    "node_modules/ksana2015-webruntime/fileinstaller.js",
    "node_modules/ksana2015-webruntime/html5fs.js",
    "node_modules/ksana2015-webruntime/htmlfs.js",
    "node_modules/ksana2015-webruntime/index.js",
    "node_modules/ksana2015-webruntime/installkdb.js",
    "node_modules/ksana2015-webruntime/kfs.js",
    "node_modules/ksana2015-webruntime/kfs_html5.js",
    "node_modules/ksana2015-webruntime/ksanagap.js",
    "node_modules/ksana2015-webruntime/livereload.js",
    "node_modules/ksana2015-webruntime/liveupdate.js",
    "node_modules/ksana2015-webruntime/mkdirp.js"
  ],
  "names": [],
  "mappings": "AAAA;ACAA;AACA;AACA;AACA;AACA;;ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5SA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "file": "generated.js",
  "sourceRoot": "",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    "var runtime=require(\"ksana2015-webruntime\");\nruntime.boot(\"decompose\",function(){\n\tvar Main=React.createElement(require(\"./src/main.jsx\"));\n\tksana.mainComponent=React.render(Main,document.getElementById(\"main\"));\n});",
    "//var kse=require(\"ksana-search\");\n// var decompose=require(\"decompose\");\nvar maincomponent = React.createClass({displayName: \"maincomponent\",\n  getInitialState:function() {\n  \treturn {result:\"result\"};\n  },\n  render: function() {\n    return (\n    React.createElement(\"div\", null, \n        this.state.result\n    )\n    );\n  }\n});\nmodule.exports=maincomponent;",
    "/** @jsx React.DOM */\n/*\nconvert to pure js\nsave -g reactify\n*/\nvar E=React.createElement;\n\nvar hasksanagap=(typeof ksanagap!=\"undefined\");\nif (hasksanagap && (typeof console==\"undefined\" || typeof console.log==\"undefined\")) {\n\t\twindow.console={log:ksanagap.log,error:ksanagap.error,debug:ksanagap.debug,warn:ksanagap.warn};\n\t\tconsole.log(\"install console output funciton\");\n}\n\nvar checkfs=function() {\n\treturn (navigator && navigator.webkitPersistentStorage) || hasksanagap;\n}\nvar featurechecks={\n\t\"fs\":checkfs\n}\nvar checkbrowser = React.createClass({\n\tgetInitialState:function() {\n\n\t\tvar missingFeatures=this.getMissingFeatures();\n\t\treturn {ready:false, missing:missingFeatures};\n\t},\n\tgetMissingFeatures:function() {\n\t\tvar feature=this.props.feature.split(\",\");\n\t\tvar status=[];\n\t\tfeature.map(function(f){\n\t\t\tvar checker=featurechecks[f];\n\t\t\tif (checker) checker=checker();\n\t\t\tstatus.push([f,checker]);\n\t\t});\n\t\treturn status.filter(function(f){return !f[1]});\n\t},\n\tdownloadbrowser:function() {\n\t\twindow.location=\"https://www.google.com/chrome/\"\n\t},\n\trenderMissing:function() {\n\t\tvar showMissing=function(m) {\n\t\t\treturn E(\"div\", null, m);\n\t\t}\n\t\treturn (\n\t\t E(\"div\", {ref: \"dialog1\", className: \"modal fade\", \"data-backdrop\": \"static\"}, \n\t\t    E(\"div\", {className: \"modal-dialog\"}, \n\t\t      E(\"div\", {className: \"modal-content\"}, \n\t\t        E(\"div\", {className: \"modal-header\"}, \n\t\t          E(\"button\", {type: \"button\", className: \"close\", \"data-dismiss\": \"modal\", \"aria-hidden\": \"true\"}, \"Ã—\"), \n\t\t          E(\"h4\", {className: \"modal-title\"}, \"Browser Check\")\n\t\t        ), \n\t\t        E(\"div\", {className: \"modal-body\"}, \n\t\t          E(\"p\", null, \"Sorry but the following feature is missing\"), \n\t\t          this.state.missing.map(showMissing)\n\t\t        ), \n\t\t        E(\"div\", {className: \"modal-footer\"}, \n\t\t          E(\"button\", {onClick: this.downloadbrowser, type: \"button\", className: \"btn btn-primary\"}, \"Download Google Chrome\")\n\t\t        )\n\t\t      )\n\t\t    )\n\t\t  )\n\t\t );\n\t},\n\trenderReady:function() {\n\t\treturn E(\"span\", null, \"browser ok\")\n\t},\n\trender:function(){\n\t\treturn  (this.state.missing.length)?this.renderMissing():this.renderReady();\n\t},\n\tcomponentDidMount:function() {\n\t\tif (!this.state.missing.length) {\n\t\t\tthis.props.onReady();\n\t\t} else {\n\t\t\t$(this.refs.dialog1.getDOMNode()).modal('show');\n\t\t}\n\t}\n});\n\nmodule.exports=checkbrowser;",
    "\nvar userCancel=false;\nvar files=[];\nvar totalDownloadByte=0;\nvar targetPath=\"\";\nvar tempPath=\"\";\nvar nfile=0;\nvar baseurl=\"\";\nvar result=\"\";\nvar downloading=false;\nvar startDownload=function(dbid,_baseurl,_files) { //return download id\n\tvar fs     = require(\"fs\");\n\tvar path   = require(\"path\");\n\n\t\n\tfiles=_files.split(\"\\uffff\");\n\tif (downloading) return false; //only one session\n\tuserCancel=false;\n\ttotalDownloadByte=0;\n\tnextFile();\n\tdownloading=true;\n\tbaseurl=_baseurl;\n\tif (baseurl[baseurl.length-1]!='/')baseurl+='/';\n\ttargetPath=ksanagap.rootPath+dbid+'/';\n\ttempPath=ksanagap.rootPath+\".tmp/\";\n\tresult=\"\";\n\treturn true;\n}\n\nvar nextFile=function() {\n\tsetTimeout(function(){\n\t\tif (nfile==files.length) {\n\t\t\tnfile++;\n\t\t\tendDownload();\n\t\t} else {\n\t\t\tdownloadFile(nfile++);\t\n\t\t}\n\t},100);\n}\n\nvar downloadFile=function(nfile) {\n\tvar url=baseurl+files[nfile];\n\tvar tmpfilename=tempPath+files[nfile];\n\tvar mkdirp = require(\"./mkdirp\");\n\tvar fs     = require(\"fs\");\n\tvar http   = require(\"http\");\n\n\tmkdirp.sync(path.dirname(tmpfilename));\n\tvar writeStream = fs.createWriteStream(tmpfilename);\n\tvar datalength=0;\n\tvar request = http.get(url, function(response) {\n\t\tresponse.on('data',function(chunk){\n\t\t\twriteStream.write(chunk);\n\t\t\ttotalDownloadByte+=chunk.length;\n\t\t\tif (userCancel) {\n\t\t\t\twriteStream.end();\n\t\t\t\tsetTimeout(function(){nextFile();},100);\n\t\t\t}\n\t\t});\n\t\tresponse.on(\"end\",function() {\n\t\t\twriteStream.end();\n\t\t\tsetTimeout(function(){nextFile();},100);\n\t\t});\n\t});\n}\n\nvar cancelDownload=function() {\n\tuserCancel=true;\n\tendDownload();\n}\nvar verify=function() {\n\treturn true;\n}\nvar endDownload=function() {\n\tnfile=files.length+1;//stop\n\tresult=\"cancelled\";\n\tdownloading=false;\n\tif (userCancel) return;\n\tvar fs     = require(\"fs\");\n\tvar mkdirp = require(\"./mkdirp\");\n\n\tfor (var i=0;i<files.length;i++) {\n\t\tvar targetfilename=targetPath+files[i];\n\t\tvar tmpfilename   =tempPath+files[i];\n\t\tmkdirp.sync(path.dirname(targetfilename));\n\t\tfs.renameSync(tmpfilename,targetfilename);\n\t}\n\tif (verify()) {\n\t\tresult=\"success\";\n\t} else {\n\t\tresult=\"error\";\n\t}\n}\n\nvar downloadedByte=function() {\n\treturn totalDownloadByte;\n}\nvar doneDownload=function() {\n\tif (nfile>files.length) return result;\n\telse return \"\";\n}\nvar downloadingFile=function() {\n\treturn nfile-1;\n}\n\nvar downloader={startDownload:startDownload, downloadedByte:downloadedByte,\n\tdownloadingFile:downloadingFile, cancelDownload:cancelDownload,doneDownload:doneDownload};\nmodule.exports=downloader;",
    "/** @jsx React.DOM */\n\n/* todo , optional kdb */\n\nvar HtmlFS=require(\"./htmlfs\");\nvar html5fs=require(\"./html5fs\");\nvar CheckBrowser=require(\"./checkbrowser\");\nvar E=React.createElement;\n  \n\nvar FileList = React.createClass({\n\tgetInitialState:function() {\n\t\treturn {downloading:false,progress:0};\n\t},\n\tupdatable:function(f) {\n        var classes=\"btn btn-warning\";\n        if (this.state.downloading) classes+=\" disabled\";\n\t\tif (f.hasUpdate) return   E(\"button\", {className: classes, \n\t\t\t\"data-filename\": f.filename, \"data-url\": f.url, \n\t            onClick: this.download\n\t       }, \"Update\")\n\t\telse return null;\n\t},\n\tshowLocal:function(f) {\n        var classes=\"btn btn-danger\";\n        if (this.state.downloading) classes+=\" disabled\";\n\t  return E(\"tr\", null, E(\"td\", null, f.filename), \n\t      E(\"td\", null), \n\t      E(\"td\", {className: \"pull-right\"}, \n\t      this.updatable(f), E(\"button\", {className: classes, \n\t               onClick: this.deleteFile, \"data-filename\": f.filename}, \"Delete\")\n\t        \n\t      )\n\t  )\n\t},  \n\tshowRemote:function(f) { \n\t  var classes=\"btn btn-warning\";\n\t  if (this.state.downloading) classes+=\" disabled\";\n\t  return (E(\"tr\", {\"data-id\": f.filename}, E(\"td\", null, \n\t      f.filename), \n\t      E(\"td\", null, f.desc), \n\t      E(\"td\", null, \n\t      E(\"span\", {\"data-filename\": f.filename, \"data-url\": f.url, \n\t            className: classes, \n\t            onClick: this.download}, \"Download\")\n\t      )\n\t  ));\n\t},\n\tshowFile:function(f) {\n\t//\treturn <span data-id={f.filename}>{f.url}</span>\n\t\treturn (f.ready)?this.showLocal(f):this.showRemote(f);\n\t},\n\treloadDir:function() {\n\t\tthis.props.action(\"reload\");\n\t},\n\tdownload:function(e) {\n\t\tvar url=e.target.dataset[\"url\"];\n\t\tvar filename=e.target.dataset[\"filename\"];\n\t\tthis.setState({downloading:true,progress:0,url:url});\n\t\tthis.userbreak=false;\n\t\thtml5fs.download(url,filename,function(){\n\t\t\tthis.reloadDir();\n\t\t\tthis.setState({downloading:false,progress:1});\n\t\t\t},function(progress,total){\n\t\t\t\tif (progress==0) {\n\t\t\t\t\tthis.setState({message:\"total \"+total})\n\t\t\t \t}\n\t\t\t \tthis.setState({progress:progress});\n\t\t\t \t//if user press abort return true\n\t\t\t \treturn this.userbreak;\n\t\t\t}\n\t\t,this);\n\t},\n\tdeleteFile:function( e) {\n\t\tvar filename=e.target.attributes[\"data-filename\"].value;\n\t\tthis.props.action(\"delete\",filename);\n\t},\n\tallFilesReady:function(e) {\n\t\treturn this.props.files.every(function(f){ return f.ready});\n\t},\n\tdismiss:function() {\n\t\t$(this.refs.dialog1.getDOMNode()).modal('hide');\n\t\tthis.props.action(\"dismiss\");\n\t},\n\tabortdownload:function() {\n\t\tthis.userbreak=true;\n\t},\n\tshowProgress:function() {\n\t     if (this.state.downloading) {\n\t      var progress=Math.round(this.state.progress*100);\n\t      return (\n\t      \tE(\"div\", null, \n\t      \t\"Downloading from \", this.state.url, \n\t      E(\"div\", {key: \"progress\", className: \"progress col-md-8\"}, \n\t          E(\"div\", {className: \"progress-bar\", role: \"progressbar\", \n\t              \"aria-valuenow\": progress, \"aria-valuemin\": \"0\", \n\t              \"aria-valuemax\": \"100\", style: {width: progress+\"%\"}}, \n\t            progress, \"%\"\n\t          )\n\t        ), \n\t        E(\"button\", {onClick: this.abortdownload, \n\t        \tclassName: \"btn btn-danger col-md-4\"}, \"Abort\")\n\t        )\n\t        );\n\t      } else {\n\t      \t\tif ( this.allFilesReady() ) {\n\t      \t\t\treturn E(\"button\", {onClick: this.dismiss, className: \"btn btn-success\"}, \"Ok\")\n\t      \t\t} else return null;\n\t      \t\t\n\t      }\n\t},\n\tshowUsage:function() {\n\t\tvar percent=this.props.remainPercent;\n           return (E(\"div\", null, E(\"span\", {className: \"pull-left\"}, \"Usage:\"), E(\"div\", {className: \"progress\"}, \n\t\t  E(\"div\", {className: \"progress-bar progress-bar-success progress-bar-striped\", role: \"progressbar\", style: {width: percent+\"%\"}}, \n\t\t    \tpercent+\"%\"\n\t\t  )\n\t\t)));\n\t},\n\trender:function() {\n\t  \treturn (\n\t\tE(\"div\", {ref: \"dialog1\", className: \"modal fade\", \"data-backdrop\": \"static\"}, \n\t\t    E(\"div\", {className: \"modal-dialog\"}, \n\t\t      E(\"div\", {className: \"modal-content\"}, \n\t\t        E(\"div\", {className: \"modal-header\"}, \n\t\t          E(\"h4\", {className: \"modal-title\"}, \"File Installer\")\n\t\t        ), \n\t\t        E(\"div\", {className: \"modal-body\"}, \n\t\t        \tE(\"table\", {className: \"table\"}, \n\t\t        \tE(\"tbody\", null, \n\t\t          \tthis.props.files.map(this.showFile)\n\t\t          \t)\n\t\t          )\n\t\t        ), \n\t\t        E(\"div\", {className: \"modal-footer\"}, \n\t\t        \tthis.showUsage(), \n\t\t           this.showProgress()\n\t\t        )\n\t\t      )\n\t\t    )\n\t\t  )\n\t\t);\n\t},\t\n\tcomponentDidMount:function() {\n\t\t$(this.refs.dialog1.getDOMNode()).modal('show');\n\t}\n});\n/*TODO kdb check version*/\nvar Filemanager = React.createClass({\n\tgetInitialState:function() {\n\t\tvar quota=this.getQuota();\n\t\treturn {browserReady:false,noupdate:true,\trequestQuota:quota,remain:0};\n\t},\n\tgetQuota:function() {\n\t\tvar q=this.props.quota||\"128M\";\n\t\tvar unit=q[q.length-1];\n\t\tvar times=1;\n\t\tif (unit==\"M\") times=1024*1024;\n\t\telse if (unit=\"K\") times=1024;\n\t\treturn parseInt(q) * times;\n\t},\n\tmissingKdb:function() {\n\t\tif (ksanagap.platform!=\"chrome\") return [];\n\t\tvar missing=this.props.needed.filter(function(kdb){\n\t\t\tfor (var i in html5fs.files) {\n\t\t\t\tif (html5fs.files[i][0]==kdb.filename) return false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},this);\n\t\treturn missing;\n\t},\n\tgetRemoteUrl:function(fn) {\n\t\tvar f=this.props.needed.filter(function(f){return f.filename==fn});\n\t\tif (f.length ) return f[0].url;\n\t},\n\tgenFileList:function(existing,missing){\n\t\tvar out=[];\n\t\tfor (var i in existing) {\n\t\t\tvar url=this.getRemoteUrl(existing[i][0]);\n\t\t\tout.push({filename:existing[i][0], url :url, ready:true });\n\t\t}\n\t\tfor (var i in missing) {\n\t\t\tout.push(missing[i]);\n\t\t}\n\t\treturn out;\n\t},\n\treload:function() {\n\t\thtml5fs.readdir(function(files){\n  \t\t\tthis.setState({files:this.genFileList(files,this.missingKdb())});\n  \t\t},this);\n\t },\n\tdeleteFile:function(fn) {\n\t  html5fs.rm(fn,function(){\n\t  \tthis.reload();\n\t  },this);\n\t},\n\tonQuoteOk:function(quota,usage) {\n\t\tif (ksanagap.platform!=\"chrome\") {\n\t\t\t//console.log(\"onquoteok\");\n\t\t\tthis.setState({noupdate:true,missing:[],files:[],autoclose:true\n\t\t\t\t,quota:quota,remain:quota-usage,usage:usage});\n\t\t\treturn;\n\t\t}\n\t\t//console.log(\"quote ok\");\n\t\tvar files=this.genFileList(html5fs.files,this.missingKdb());\n\t\tvar that=this;\n\t\tthat.checkIfUpdate(files,function(hasupdate) {\n\t\t\tvar missing=this.missingKdb();\n\t\t\tvar autoclose=this.props.autoclose;\n\t\t\tif (missing.length) autoclose=false;\n\t\t\tthat.setState({autoclose:autoclose,\n\t\t\t\tquota:quota,usage:usage,files:files,\n\t\t\t\tmissing:missing,\n\t\t\t\tnoupdate:!hasupdate,\n\t\t\t\tremain:quota-usage});\n\t\t});\n\t},  \n\tonBrowserOk:function() {\n\t  this.totalDownloadSize();\n\t}, \n\tdismiss:function() {\n\t\tthis.props.onReady(this.state.usage,this.state.quota);\n\t\tsetTimeout(function(){\n\t\t\tvar modalin=$(\".modal.in\");\n\t\t\tif (modalin.modal) modalin.modal('hide');\n\t\t},500);\n\t}, \n\ttotalDownloadSize:function() {\n\t\tvar files=this.missingKdb();\n\t\tvar taskqueue=[],totalsize=0;\n\t\tfor (var i=0;i<files.length;i++) {\n\t\t\ttaskqueue.push(\n\t\t\t\t(function(idx){\n\t\t\t\t\treturn (function(data){\n\t\t\t\t\t\tif (!(typeof data=='object' && data.__empty)) totalsize+=data;\n\t\t\t\t\t\thtml5fs.getDownloadSize(files[idx].url,taskqueue.shift());\n\t\t\t\t\t});\n\t\t\t\t})(i)\n\t\t\t);\n\t\t}\n\t\tvar that=this;\n\t\ttaskqueue.push(function(data){\t\n\t\t\ttotalsize+=data;\n\t\t\tsetTimeout(function(){that.setState({requireSpace:totalsize,browserReady:true})},0);\n\t\t});\n\t\ttaskqueue.shift()({__empty:true});\n\t},\n\tcheckIfUpdate:function(files,cb) {\n\t\tvar taskqueue=[];\n\t\tfor (var i=0;i<files.length;i++) {\n\t\t\ttaskqueue.push(\n\t\t\t\t(function(idx){\n\t\t\t\t\treturn (function(data){\n\t\t\t\t\t\tif (!(typeof data=='object' && data.__empty)) files[idx-1].hasUpdate=data;\n\t\t\t\t\t\thtml5fs.checkUpdate(files[idx].url,files[idx].filename,taskqueue.shift());\n\t\t\t\t\t});\n\t\t\t\t})(i)\n\t\t\t);\n\t\t}\n\t\tvar that=this;\n\t\ttaskqueue.push(function(data){\t\n\t\t\tfiles[files.length-1].hasUpdate=data;\n\t\t\tvar hasupdate=files.some(function(f){return f.hasUpdate});\n\t\t\tif (cb) cb.apply(that,[hasupdate]);\n\t\t});\n\t\ttaskqueue.shift()({__empty:true});\n\t},\n\trender:function(){\n    \t\tif (!this.state.browserReady) {   \n      \t\t\treturn E(CheckBrowser, {feature: \"fs\", onReady: this.onBrowserOk})\n    \t\t} if (!this.state.quota || this.state.remain<this.state.requireSpace) {  \n    \t\t\tvar quota=this.state.requestQuota;\n    \t\t\tif (this.state.usage+this.state.requireSpace>quota) {\n    \t\t\t\tquota=(this.state.usage+this.state.requireSpace)*1.5;\n    \t\t\t}\n      \t\t\treturn E(HtmlFS, {quota: quota, autoclose: \"true\", onReady: this.onQuoteOk})\n      \t\t} else {\n\t\t\tif (!this.state.noupdate || this.missingKdb().length || !this.state.autoclose) {\n\t\t\t\tvar remain=Math.round((this.state.usage/this.state.quota)*100);\t\t\t\t\n\t\t\t\treturn E(FileList, {action: this.action, files: this.state.files, remainPercent: remain})\n\t\t\t} else {\n\t\t\t\tsetTimeout( this.dismiss ,0);\n\t\t\t\treturn E(\"span\", null, \"Success\");\n\t\t\t}\n      \t\t}\n\t},\n\taction:function() {\n\t  var args = Array.prototype.slice.call(arguments);\n\t  var type=args.shift();\n\t  var res=null, that=this;\n\t  if (type==\"delete\") {\n\t    this.deleteFile(args[0]);\n\t  }  else if (type==\"reload\") {\n\t  \tthis.reload();\n\t  } else if (type==\"dismiss\") {\n\t  \tthis.dismiss();\n\t  }\n\t}\n});\n\nmodule.exports=Filemanager;",
    "/* emulate filesystem on html5 browser */\nvar get_head=function(url,field,cb){\n\tvar xhr = new XMLHttpRequest();\n\txhr.open(\"HEAD\", url, true);\n\txhr.onreadystatechange = function() {\n\t\t\tif (this.readyState == this.DONE) {\n\t\t\t\tcb(xhr.getResponseHeader(field));\n\t\t\t} else {\n\t\t\t\tif (this.status!==200&&this.status!==206) {\n\t\t\t\t\tcb(\"\");\n\t\t\t\t}\n\t\t\t} \n\t};\n\txhr.send();\t\n}\nvar get_date=function(url,cb) {\n\tget_head(url,\"Last-Modified\",function(value){\n\t\tcb(value);\n\t});\n}\nvar get_size=function(url, cb) {\n\tget_head(url,\"Content-Length\",function(value){\n\t\tcb(parseInt(value));\n\t});\n};\nvar checkUpdate=function(url,fn,cb) {\n\tif (!url) {\n\t\tcb(false);\n\t\treturn;\n\t}\n\tget_date(url,function(d){\n\t\tAPI.fs.root.getFile(fn, {create: false, exclusive: false}, function(fileEntry) {\n\t\t\tfileEntry.getMetadata(function(metadata){\n\t\t\t\tvar localDate=Date.parse(metadata.modificationTime);\n\t\t\t\tvar urlDate=Date.parse(d);\n\t\t\t\tcb(urlDate>localDate);\n\t\t\t});\n\t\t},function(){\n\t\t\tcb(false);\n\t\t});\n\t});\n}\nvar download=function(url,fn,cb,statuscb,context) {\n\t var totalsize=0,batches=null,written=0;\n\t var fileEntry=0, fileWriter=0;\n\t var createBatches=function(size) {\n\t\tvar bytes=1024*1024, out=[];\n\t\tvar b=Math.floor(size / bytes);\n\t\tvar last=size %bytes;\n\t\tfor (var i=0;i<=b;i++) {\n\t\t\tout.push(i*bytes);\n\t\t}\n\t\tout.push(b*bytes+last);\n\t\treturn out;\n\t }\n\t var finish=function() {\n\t\t rm(fn,function(){\n\t\t\t\tfileEntry.moveTo(fileEntry.filesystem.root, fn,function(){\n\t\t\t\t\tsetTimeout( cb.bind(context,false) , 0) ; \n\t\t\t\t},function(e){\n\t\t\t\t\tconsole.log(\"failed\",e)\n\t\t\t\t});\n\t\t },this); \n\t };\n\t\tvar tempfn=\"temp.kdb\";\n\t\tvar batch=function(b) {\n\t\tvar abort=false;\n\t\tvar xhr = new XMLHttpRequest();\n\t\tvar requesturl=url+\"?\"+Math.random();\n\t\txhr.open('get', requesturl, true);\n\t\txhr.setRequestHeader('Range', 'bytes='+batches[b]+'-'+(batches[b+1]-1));\n\t\txhr.responseType = 'blob';    \n\t\txhr.addEventListener('load', function() {\n\t\t\tvar blob=this.response;\n\t\t\tfileEntry.createWriter(function(fileWriter) {\n\t\t\t\tfileWriter.seek(fileWriter.length);\n\t\t\t\tfileWriter.write(blob);\n\t\t\t\twritten+=blob.size;\n\t\t\t\tfileWriter.onwriteend = function(e) {\n\t\t\t\t\tif (statuscb) {\n\t\t\t\t\t\tabort=statuscb.apply(context,[ fileWriter.length / totalsize,totalsize ]);\n\t\t\t\t\t\tif (abort) setTimeout( cb.bind(context,false) , 0) ;\n\t\t\t\t \t}\n\t\t\t\t\tb++;\n\t\t\t\t\tif (!abort) {\n\t\t\t\t\t\tif (b<batches.length-1) setTimeout(batch.bind(context,b),0);\n\t\t\t\t\t\telse                    finish();\n\t\t\t\t \t}\n\t\t\t \t};\n\t\t\t}, console.error);\n\t\t},false);\n\t\txhr.send();\n\t}\n\n\tget_size(url,function(size){\n\t\ttotalsize=size;\n\t\tif (!size) {\n\t\t\tif (cb) cb.apply(context,[false]);\n\t\t} else {//ready to download\n\t\t\trm(tempfn,function(){\n\t\t\t\t batches=createBatches(size);\n\t\t\t\t if (statuscb) statuscb.apply(context,[ 0, totalsize ]);\n\t\t\t\t API.fs.root.getFile(tempfn, {create: 1, exclusive: false}, function(_fileEntry) {\n\t\t\t\t\t\t\tfileEntry=_fileEntry;\n\t\t\t\t\t\tbatch(0);\n\t\t\t\t });\n\t\t\t},this);\n\t\t}\n\t});\n}\n\nvar readFile=function(filename,cb,context) {\n\tAPI.fs.root.getFile(filename, function(fileEntry) {\n\t\t\tvar reader = new FileReader();\n\t\t\treader.onloadend = function(e) {\n\t\t\t\t\tif (cb) cb.apply(cb,[this.result]);\n\t\t\t\t};            \n\t}, console.error);\n}\nvar writeFile=function(filename,buf,cb,context){\n\tAPI.fs.root.getFile(filename, {create: true, exclusive: true}, function(fileEntry) {\n\t\t\tfileEntry.createWriter(function(fileWriter) {\n\t\t\t\tfileWriter.write(buf);\n\t\t\t\tfileWriter.onwriteend = function(e) {\n\t\t\t\t\tif (cb) cb.apply(cb,[buf.byteLength]);\n\t\t\t\t};            \n\t\t\t}, console.error);\n\t}, console.error);\n}\n\nvar readdir=function(cb,context) {\n\tvar dirReader = API.fs.root.createReader();\n\tvar out=[],that=this;\n\tdirReader.readEntries(function(entries) {\n\t\tif (entries.length) {\n\t\t\tfor (var i = 0, entry; entry = entries[i]; ++i) {\n\t\t\t\tif (entry.isFile) {\n\t\t\t\t\tout.push([entry.name,entry.toURL ? entry.toURL() : entry.toURI()]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tAPI.files=out;\n\t\tif (cb) cb.apply(context,[out]);\n\t}, function(){\n\t\tif (cb) cb.apply(context,[null]);\n\t});\n}\nvar getFileURL=function(filename) {\n\tif (!API.files ) return null;\n\tvar file= API.files.filter(function(f){return f[0]==filename});\n\tif (file.length) return file[0][1];\n}\nvar rm=function(filename,cb,context) {\n\tvar url=getFileURL(filename);\n\tif (url) rmURL(url,cb,context);\n\telse if (cb) cb.apply(context,[false]);\n}\n\nvar rmURL=function(filename,cb,context) {\n\twebkitResolveLocalFileSystemURL(filename, function(fileEntry) {\n\t\tfileEntry.remove(function() {\n\t\t\tif (cb) cb.apply(context,[true]);\n\t\t}, console.error);\n\t},  function(e){\n\t\tif (cb) cb.apply(context,[false]);//no such file\n\t});\n}\nfunction errorHandler(e) {\n\tconsole.error('Error: ' +e.name+ \" \"+e.message);\n}\nvar initfs=function(grantedBytes,cb,context) {\n\twebkitRequestFileSystem(PERSISTENT, grantedBytes,  function(fs) {\n\t\tAPI.fs=fs;\n\t\tAPI.quota=grantedBytes;\n\t\treaddir(function(){\n\t\t\tAPI.initialized=true;\n\t\t\tcb.apply(context,[grantedBytes,fs]);\n\t\t},context);\n\t}, errorHandler);\n}\nvar init=function(quota,cb,context) {\n\tnavigator.webkitPersistentStorage.requestQuota(quota, \n\t\t\tfunction(grantedBytes) {\n\t\t\t\tinitfs(grantedBytes,cb,context);\n\t\t}, errorHandler\n\t);\n}\nvar queryQuota=function(cb,context) {\n\tvar that=this;\n\tnavigator.webkitPersistentStorage.queryUsageAndQuota( \n\t function(usage,quota){\n\t\t\tinitfs(quota,function(){\n\t\t\t\tcb.apply(context,[usage,quota]);\n\t\t\t},context);\n\t});\n}\nvar API={\n\tinit:init\n\t,readdir:readdir\n\t,checkUpdate:checkUpdate\n\t,rm:rm\n\t,rmURL:rmURL\n\t,getFileURL:getFileURL\n\t,writeFile:writeFile\n\t,readFile:readFile\n\t,download:download\n\t,get_head:get_head\n\t,get_date:get_date\n\t,get_size:get_size\n\t,getDownloadSize:get_size\n\t,queryQuota:queryQuota\n}\nmodule.exports=API;",
    "var html5fs=require(\"./html5fs\");\nvar E=React.createElement;\n\nvar htmlfs = React.createClass({\n\tgetInitialState:function() { \n\t\treturn {ready:false, quota:0,usage:0,Initialized:false,autoclose:this.props.autoclose};\n\t},\n\tinitFilesystem:function() {\n\t\tvar quota=this.props.quota||1024*1024*128; // default 128MB\n\t\tquota=parseInt(quota);\n\t\thtml5fs.init(quota,function(q){\n\t\t\tthis.dialog=false;\n\t\t\t$(this.refs.dialog1.getDOMNode()).modal('hide');\n\t\t\tthis.setState({quota:q,autoclose:true});\n\t\t},this);\n\t},\n\twelcome:function() {\n\t\treturn (\n\t\tE(\"div\", {ref: \"dialog1\", className: \"modal fade\", id: \"myModal\", \"data-backdrop\": \"static\"}, \n\t\t    E(\"div\", {className: \"modal-dialog\"}, \n\t\t      E(\"div\", {className: \"modal-content\"}, \n\t\t        E(\"div\", {className: \"modal-header\"}, \n\t\t          E(\"h4\", {className: \"modal-title\"}, \"Welcome\")\n\t\t        ), \n\t\t        E(\"div\", {className: \"modal-body\"}, \n\t\t          \"Browser will ask for your confirmation.\"\n\t\t        ), \n\t\t        E(\"div\", {className: \"modal-footer\"}, \n\t\t          E(\"button\", {onClick: this.initFilesystem, type: \"button\", \n\t\t            className: \"btn btn-primary\"}, \"Initialize File System\")\n\t\t        )\n\t\t      )\n\t\t    )\n\t\t  )\n\t\t );\n\t},\n\trenderDefault:function(){\n\t\tvar used=Math.floor(this.state.usage/this.state.quota *100);\n\t\tvar more=function() {\n\t\t\tif (used>50) return E(\"button\", {type: \"button\", className: \"btn btn-primary\"}, \"Allocate More\");\n\t\t\telse null;\n\t\t}\n\t\treturn (\n\t\tE(\"div\", {ref: \"dialog1\", className: \"modal fade\", id: \"myModal\", \"data-backdrop\": \"static\"}, \n\t\t    E(\"div\", {className: \"modal-dialog\"}, \n\t\t      E(\"div\", {className: \"modal-content\"}, \n\t\t        E(\"div\", {className: \"modal-header\"}, \n\t\t          E(\"h4\", {className: \"modal-title\"}, \"Sandbox File System\")\n\t\t        ), \n\t\t        E(\"div\", {className: \"modal-body\"}, \n\t\t          E(\"div\", {className: \"progress\"}, \n\t\t            E(\"div\", {className: \"progress-bar\", role: \"progressbar\", style: {width: used+\"%\"}}, \n\t\t               used, \"%\"\n\t\t            )\n\t\t          ), \n\t\t          E(\"span\", null, this.state.quota, \" total , \", this.state.usage, \" in used\")\n\t\t        ), \n\t\t        E(\"div\", {className: \"modal-footer\"}, \n\t\t          E(\"button\", {onClick: this.dismiss, type: \"button\", className: \"btn btn-default\", \"data-dismiss\": \"modal\"}, \"Close\"), \n\t\t          more()\n\t\t        )\n\t\t      )\n\t\t    )\n\t\t  )\n\t\t  );\n\t},\n\tdismiss:function() {\n\t\tvar that=this;\n\t\tsetTimeout(function(){\n\t\t\tthat.props.onReady(that.state.quota,that.state.usage);\t\n\t\t},0);\n\t},\n\tqueryQuota:function() {\n\t\tif (ksanagap.platform==\"chrome\") {\n\t\t\thtml5fs.queryQuota(function(usage,quota){\n\t\t\t\tthis.setState({usage:usage,quota:quota,initialized:true});\n\t\t\t},this);\t\t\t\n\t\t} else {\n\t\t\tthis.setState({usage:333,quota:1000*1000*1024,initialized:true,autoclose:true});\n\t\t}\n\t},\n\trender:function() {\n\t\tvar that=this;\n\t\tif (!this.state.quota || this.state.quota<this.props.quota) {\n\t\t\tif (this.state.initialized) {\n\t\t\t\tthis.dialog=true;\n\t\t\t\treturn this.welcome();\t\n\t\t\t} else {\n\t\t\t\treturn E(\"span\", null, \"checking quota\");\n\t\t\t}\t\t\t\n\t\t} else {\n\t\t\tif (!this.state.autoclose) {\n\t\t\t\tthis.dialog=true;\n\t\t\t\treturn this.renderDefault(); \n\t\t\t}\n\t\t\tthis.dismiss();\n\t\t\tthis.dialog=false;\n\t\t\treturn null;\n\t\t}\n\t},\n\tcomponentDidMount:function() {\n\t\tif (!this.state.quota) {\n\t\t\tthis.queryQuota();\n\n\t\t};\n\t},\n\tcomponentDidUpdate:function() {\n\t\tif (this.dialog) $(this.refs.dialog1.getDOMNode()).modal('show');\n\t}\n});\n\nmodule.exports=htmlfs;",
    "var ksana={\"platform\":\"remote\"};\nif (typeof window!=\"undefined\") {\n\twindow.ksana=ksana;\n\tif (typeof ksanagap==\"undefined\") {\n\t\twindow.ksanagap=require(\"./ksanagap\"); //compatible layer with mobile\n\t}\n}\nif (typeof process !=\"undefined\") {\n\tif (process.versions && process.versions[\"node-webkit\"]) {\n  \t\tif (typeof nodeRequire!=\"undefined\") ksana.require=nodeRequire;\n  \t\tksana.platform=\"node-webkit\";\n  \t\twindow.ksanagap.platform=\"node-webkit\";\n\t\tvar ksanajs=require(\"fs\").readFileSync(\"ksana.js\",\"utf8\").trim();\n\t\tksana.js=JSON.parse(ksanajs.substring(14,ksanajs.length-1));\n\t\twindow.kfs=require(\"./kfs\");\n  \t}\n} else if (typeof chrome!=\"undefined\"){//} && chrome.fileSystem){\n//\twindow.ksanagap=require(\"./ksanagap\"); //compatible layer with mobile\n\twindow.ksanagap.platform=\"chrome\";\n\twindow.kfs=require(\"./kfs_html5\");\n\tif(window.location.origin.indexOf(\"//127.0.0.1\")>-1) {\n\t\trequire(\"./livereload\")();\n\t}\n\tksana.platform=\"chrome\";\n} else {\n\tif (typeof ksanagap!=\"undefined\" && typeof fs!=\"undefined\") {//mobile\n\t\tvar ksanajs=fs.readFileSync(\"ksana.js\",\"utf8\").trim(); //android extra \\n at the end\n\t\tksana.js=JSON.parse(ksanajs.substring(14,ksanajs.length-1));\n\t\tksana.platform=ksanagap.platform;\n\t\tif (typeof ksanagap.android !=\"undefined\") {\n\t\t\tksana.platform=\"android\";\n\t\t}\n\t}\n}\nvar timer=null;\nvar boot=function(appId,cb) {\n\tif (typeof React!=\"undefined\") {\n\t\tReact.initializeTouchEvents(true);\n\t}\n\tksana.appId=appId;\n\tif (ksanagap.platform==\"chrome\") { //need to wait for jsonp ksana.js\n\t\ttimer=setInterval(function(){\n\t\t\tif (ksana.ready){\n\t\t\t\tclearInterval(timer);\n\t\t\t\tif (ksana.js && ksana.js.files && ksana.js.files.length) {\n\t\t\t\t\trequire(\"./installkdb\")(ksana.js,cb);\n\t\t\t\t} else {\n\t\t\t\t\tcb();\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t},300);\n\t} else {\n\t\tcb();\n\t}\n}\n\nmodule.exports={boot:boot\n\t,htmlfs:require(\"./htmlfs\")\n\t,html5fs:require(\"./html5fs\")\n\t,liveupdate:require(\"./liveupdate\")\n\t,fileinstaller:require(\"./fileinstaller\")\n\t,downloader:require(\"./downloader\")\n\t,installkdb:require(\"./installkdb\")\n};",
    "var Fileinstaller=require(\"./fileinstaller\");\n\nvar getRequire_kdb=function() {\n    var required=[];\n    ksana.js.files.map(function(f){\n      if (f.indexOf(\".kdb\")==f.length-4) {\n        var slash=f.lastIndexOf(\"/\");\n        if (slash>-1) {\n          var dbid=f.substring(slash+1,f.length-4);\n          required.push({url:f,dbid:dbid,filename:dbid+\".kdb\"});\n        } else {\n          var dbid=f.substring(0,f.length-4);\n          required.push({url:ksana.js.baseurl+f,dbid:dbid,filename:f});\n        }        \n      }\n    });\n    return required;\n}\nvar callback=null;\nvar onReady=function() {\n\tcallback();\n}\nvar openFileinstaller=function(keep) {\n\tvar require_kdb=getRequire_kdb().map(function(db){\n\t  return {\n\t    url:window.location.origin+window.location.pathname+db.dbid+\".kdb\",\n\t    dbdb:db.dbid,\n\t    filename:db.filename\n\t  }\n\t})\n\treturn React.createElement(Fileinstaller, {quota: \"512M\", autoclose: !keep, needed: require_kdb, \n\t                 onReady: onReady});\n}\nvar installkdb=function(ksanajs,cb,context) {\n\tReact.render(openFileinstaller(),document.getElementById(\"main\"));\n\tcallback=cb;\n}\nmodule.exports=installkdb;",
    "//Simulate feature in ksanagap\n/* \n  runs on node-webkit only\n*/\n\nvar readDir=function(path) { //simulate Ksanagap function\n\tvar fs=nodeRequire(\"fs\");\n\tpath=path||\"..\";\n\tvar dirs=[];\n\tif (path[0]==\".\") {\n\t\tif (path==\".\") dirs=fs.readdirSync(\".\");\n\t\telse {\n\t\t\tdirs=fs.readdirSync(\"..\");\n\t\t}\n\t} else {\n\t\tdirs=fs.readdirSync(path);\n\t}\n\n\treturn dirs.join(\"\\uffff\");\n}\nvar listApps=function() {\n\tvar fs=nodeRequire(\"fs\");\n\tvar ksanajsfile=function(d) {return \"../\"+d+\"/ksana.js\"};\n\tvar dirs=fs.readdirSync(\"..\").filter(function(d){\n\t\t\t\treturn fs.statSync(\"../\"+d).isDirectory() && d[0]!=\".\"\n\t\t\t\t   && fs.existsSync(ksanajsfile(d));\n\t});\n\t\n\tvar out=dirs.map(function(d){\n\t\tvar content=fs.readFileSync(ksanajsfile(d),\"utf8\");\n  \t\tcontent=content.replace(\"})\",\"}\");\n  \t\tcontent=content.replace(\"jsonp_handler(\",\"\");\n  \t\ttry{\n  \t\t\tvar obj= JSON.parse(content);\n\t\t\tobj.dbid=d;\n\t\t\tobj.path=d;\n\t\t\treturn obj;\n  \t\t} catch(e) {\n  \t\t\tconsole.log(e);\n  \t\t\treturn null;\n  \t\t}\n\t});\n\n\tout=out.filter(function(o){return !!o});\n\treturn JSON.stringify(out);\n}\n\n\n\nvar kfs={readDir:readDir,listApps:listApps};\n\nmodule.exports=kfs;",
    "var readDir=function(){\n\treturn \"[]\";\n}\nvar listApps=function(){\n\treturn \"[]\";\n}\nmodule.exports={readDir:readDir,listApps:listApps};",
    "var appname=\"installer\";\nvar switchApp=function(path) {\n\tvar fs=require(\"fs\");\n\tpath=\"../\"+path;\n\tappname=path;\n\tdocument.location.href= path+\"/index.html\"; \n\tprocess.chdir(path);\n}\nvar downloader={};\nvar rootPath=\"\";\n\nvar deleteApp=function(app) {\n\tconsole.error(\"not allow on PC, do it in File Explorer/ Finder\");\n}\nvar username=function() {\n\treturn \"\";\n}\nvar useremail=function() {\n\treturn \"\"\n}\nvar runtime_version=function() {\n\treturn \"1.4\";\n}\n\n//copy from liveupdate\nvar jsonp=function(url,dbid,callback,context) {\n  var script=document.getElementById(\"jsonp2\");\n  if (script) {\n    script.parentNode.removeChild(script);\n  }\n  window.jsonp_handler=function(data) {\n    if (typeof data==\"object\") {\n      data.dbid=dbid;\n      callback.apply(context,[data]);    \n    }  \n  }\n  window.jsonp_error_handler=function() {\n    console.error(\"url unreachable\",url);\n    callback.apply(context,[null]);\n  }\n  script=document.createElement('script');\n  script.setAttribute('id', \"jsonp2\");\n  script.setAttribute('onerror', \"jsonp_error_handler()\");\n  url=url+'?'+(new Date().getTime());\n  script.setAttribute('src', url);\n  document.getElementsByTagName('head')[0].appendChild(script); \n}\n\nvar ksanagap={\n\tplatform:\"node-webkit\",\n\tstartDownload:downloader.startDownload,\n\tdownloadedByte:downloader.downloadedByte,\n\tdownloadingFile:downloader.downloadingFile,\n\tcancelDownload:downloader.cancelDownload,\n\tdoneDownload:downloader.doneDownload,\n\tswitchApp:switchApp,\n\trootPath:rootPath,\n\tdeleteApp: deleteApp,\n\tusername:username, //not support on PC\n\tuseremail:username,\n\truntime_version:runtime_version,\n\t\n}\n\nif (typeof process!=\"undefined\" && !process.browser) {\n\tvar ksanajs=require(\"fs\").readFileSync(\"./ksana.js\",\"utf8\").trim();\n\tdownloader=require(\"./downloader\");\n\t//ksana.js=JSON.parse(ksanajs.substring(14,ksanajs.length-1));\n\trootPath=process.cwd();\n\trootPath=require(\"path\").resolve(rootPath,\"..\").replace(/\\\\/g,\"/\")+'/';\n\tksana.ready=true;\n} else{\n\tvar url=window.location.origin+window.location.pathname.replace(\"index.html\",\"\")+\"ksana.js\";\n\tjsonp(url,appname,function(data){\n\t\tksana.js=data;\n\t\tksana.ready=true;\n\t});\n}\nmodule.exports=ksanagap;",
    "var started=false;\nvar timer=null;\nvar bundledate=null;\nvar get_date=require(\"./html5fs\").get_date;\nvar checkIfBundleUpdated=function() {\n\tget_date(\"bundle.js\",function(date){\n\t\tif (bundledate &&bundledate!=date){\n\t\t\tlocation.reload();\n\t\t}\n\t\tbundledate=date;\n\t});\n}\nvar livereload=function() {\n\tif (started) return;\n\n\ttimer1=setInterval(function(){\n\t\tcheckIfBundleUpdated();\n\t},2000);\n\tstarted=true;\n}\n\nmodule.exports=livereload;",
    "\nvar jsonp=function(url,dbid,callback,context) {\n  var script=document.getElementById(\"jsonp\");\n  if (script) {\n    script.parentNode.removeChild(script);\n  }\n  if (typeof dbid==\"function\") {\n    context=callback;\n    callback=dbid;\n    dbid=\"\";\n  }\n  window.jsonp_handler=function(data) {\n    //console.log(\"receive from ksana.js\",data);\n    if (typeof data==\"object\" && dbid) {\n      if (typeof data.dbid==\"undefined\") {\n        data.dbid=dbid;\n      }\n    }\n    callback.apply(context,[data]);\n  }\n\n  window.jsonp_error_handler=function() {\n    console.error(\"url unreachable\",url);\n    callback.apply(context,[null]);\n  }\n\n  script=document.createElement('script');\n  script.setAttribute('id', \"jsonp\");\n  script.setAttribute('onerror', \"jsonp_error_handler()\");\n  url=url+'?'+(new Date().getTime());\n  script.setAttribute('src', url);\n  document.getElementsByTagName('head')[0].appendChild(script); \n}\nvar runtime_version_ok=function(minruntime) {\n  if (!minruntime) return true;//not mentioned.\n  var min=parseFloat(minruntime);\n  var runtime=parseFloat( ksanagap.runtime_version()||\"1.0\");\n  if (min>runtime) return false;\n  return true;\n}\n\nvar needToUpdate=function(fromjson,tojson) {\n  var needUpdates=[];\n  for (var i=0;i<fromjson.length;i++) { \n    var to=tojson[i];\n    var from=fromjson[i];\n    var newfiles=[],newfilesizes=[],removed=[];\n    \n    if (!to) continue; //cannot reach host\n    if (!runtime_version_ok(to.minruntime)) {\n      console.warn(\"runtime too old, need \"+to.minruntime);\n      continue; \n    }\n    if (!from.filedates) {\n      console.warn(\"missing filedates in ksana.js of \"+from.dbid);\n      continue;\n    }\n    from.filedates.map(function(f,idx){\n      var newidx=to.files.indexOf( from.files[idx]);\n      if (newidx==-1) {\n        //file removed in new version\n        removed.push(from.files[idx]);\n      } else {\n        var fromdate=Date.parse(f);\n        var todate=Date.parse(to.filedates[newidx]);\n        if (fromdate<todate) {\n          newfiles.push( to.files[newidx] );\n          newfilesizes.push(to.filesizes[newidx]);\n        }        \n      }\n    });\n    if (newfiles.length) {\n      from.newfiles=newfiles;\n      from.newfilesizes=newfilesizes;\n      from.removed=removed;\n      needUpdates.push(from);\n    }\n  }\n  return needUpdates;\n}\nvar getUpdatables=function(apps,cb,context) {\n  getRemoteJson(apps,function(jsons){\n    var hasUpdates=needToUpdate(apps,jsons);\n    cb.apply(context,[hasUpdates]);\n  },context);\n}\nvar getRemoteJson=function(apps,cb,context) {\n  var taskqueue=[],output=[];\n  var makecb=function(app){\n    return function(data){\n        if (!(data && typeof data =='object' && data.__empty)) output.push(data);\n        if (!app.baseurl) {\n          taskqueue.shift({__empty:true});\n        } else {\n          var url=app.baseurl+\"/ksana.js\";    \n          console.log(url);\n          jsonp( url ,app.dbid,taskqueue.shift(), context);           \n        }\n    };\n  };\n  apps.forEach(function(app){taskqueue.push(makecb(app))});\n\n  taskqueue.push(function(data){\n    output.push(data);\n    cb.apply(context,[output]);\n  });\n\n  taskqueue.shift()({__empty:true}); //run the task\n}\nvar humanFileSize=function(bytes, si) {\n    var thresh = si ? 1000 : 1024;\n    if(bytes < thresh) return bytes + ' B';\n    var units = si ? ['kB','MB','GB','TB','PB','EB','ZB','YB'] : ['KiB','MiB','GiB','TiB','PiB','EiB','ZiB','YiB'];\n    var u = -1;\n    do {\n        bytes /= thresh;\n        ++u;\n    } while(bytes >= thresh);\n    return bytes.toFixed(1)+' '+units[u];\n};\nvar humanDate=function(datestring) {\n    var d=Date.parse(datestring);\n    if (isNaN(d)) {\n      return \"invalid date\";\n    } else {\n      return new Date(d).toLocaleString();\n    }\n}\nvar start=function(ksanajs,cb,context){\n  var files=ksanajs.newfiles||ksanajs.files;\n  var baseurl=ksanajs.baseurl|| \"http://127.0.0.1:8080/\"+ksanajs.dbid+\"/\";\n  var started=ksanagap.startDownload(ksanajs.dbid,baseurl,files.join(\"\\uffff\"));\n  cb.apply(context,[started]);\n}\nvar status=function(){\n  var nfile=ksanagap.downloadingFile();\n  var downloadedByte=ksanagap.downloadedByte();\n  var done=ksanagap.doneDownload();\n  return {nfile:nfile,downloadedByte:downloadedByte, done:done};\n}\n\nvar cancel=function(){\n  return ksanagap.cancelDownload();\n}\n\nvar liveupdate={ humanFileSize: humanFileSize, humanDate:humanDate,\n  needToUpdate: needToUpdate , jsonp:jsonp, \n  getUpdatables:getUpdatables,\n  start:start,\n  cancel:cancel,\n  status:status\n  };\nmodule.exports=liveupdate;",
    "function mkdirP (p, mode, f, made) {\n     var path = nodeRequire('path');\n     var fs = nodeRequire('fs');\n\t\n    if (typeof mode === 'function' || mode === undefined) {\n        f = mode;\n        mode = 0x1FF & (~process.umask());\n    }\n    if (!made) made = null;\n\n    var cb = f || function () {};\n    if (typeof mode === 'string') mode = parseInt(mode, 8);\n    p = path.resolve(p);\n\n    fs.mkdir(p, mode, function (er) {\n        if (!er) {\n            made = made || p;\n            return cb(null, made);\n        }\n        switch (er.code) {\n            case 'ENOENT':\n                mkdirP(path.dirname(p), mode, function (er, made) {\n                    if (er) cb(er, made);\n                    else mkdirP(p, mode, cb, made);\n                });\n                break;\n\n            // In the case of any other error, just see if there's a dir\n            // there already.  If so, then hooray!  If not, then something\n            // is borked.\n            default:\n                fs.stat(p, function (er2, stat) {\n                    // if the stat fails, then that's super weird.\n                    // let the original error be the failure reason.\n                    if (er2 || !stat.isDirectory()) cb(er, made)\n                    else cb(null, made);\n                });\n                break;\n        }\n    });\n}\n\nmkdirP.sync = function sync (p, mode, made) {\n    var path = nodeRequire('path');\n    var fs = nodeRequire('fs');\n    if (mode === undefined) {\n        mode = 0x1FF & (~process.umask());\n    }\n    if (!made) made = null;\n\n    if (typeof mode === 'string') mode = parseInt(mode, 8);\n    p = path.resolve(p);\n\n    try {\n        fs.mkdirSync(p, mode);\n        made = made || p;\n    }\n    catch (err0) {\n        switch (err0.code) {\n            case 'ENOENT' :\n                made = sync(path.dirname(p), mode, made);\n                sync(p, mode, made);\n                break;\n\n            // In the case of any other error, just see if there's a dir\n            // there already.  If so, then hooray!  If not, then something\n            // is borked.\n            default:\n                var stat;\n                try {\n                    stat = fs.statSync(p);\n                }\n                catch (err1) {\n                    throw err0;\n                }\n                if (!stat.isDirectory()) throw err0;\n                break;\n        }\n    }\n\n    return made;\n};\n\nmodule.exports = mkdirP.mkdirp = mkdirP.mkdirP = mkdirP;\n"
  ]
}